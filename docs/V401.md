V401.md — Building Visual Meter (Final Spec)
Status: Draft → To Implement
Purpose: Replace the cluttered “many tiny tables” layout with a clean, scalable 10‑slot meter per building. Each slot represents 100 units and fills progressively as the player buys more.

---

1. Scope

This spec applies to:
- Poker Table (V1 core building)
- All future buildings in the Buildings section

Non‑goals:
- No change to economy, costs, cps, or formulas
- No change to buy logic (Buy 1 / Buy X / Buy Max)
- No change to building unlock rules

This is a pure visual/UX upgrade.

---

2. Core Concept

Each building now has a **10‑slot meter**:

- Total slots: 10
- Each slot represents: 100 owned units
- Slots fill progressively based on owned count
- Works for 0 → 999 units (beyond that, meter stays full but numbers still grow)

Example:
- Owned: 0 → all 10 slots empty
- Owned: 37 → slot 1 partially filled (37%), slots 2–10 empty
- Owned: 145 → slot 1 full, slot 2 at 45%, slots 3–10 empty
- Owned: 1000+ → all 10 slots full (visual cap), numeric “Owned” continues to increase

---

3. Visual Layout (Per Building Card)

Each building card should follow this structure:

Top row:
- Left: Building name (e.g., “Poker Table”)
- Right: Key stat (e.g., “+1 cps each”)

Middle row:
- Left: “Owned: X”
- Right: Buy controls (unchanged: Buy 1 / Buy X / Buy Max or current pattern)

Bottom row:
- 10‑slot meter, horizontal, each slot showing the building’s icon in one of three states:
  - Empty
  - Partial
  - Full

Example layout (conceptual):

Poker Table     Owned: 371    +1 cps each    [Buy controls]     

[slot][slot][slot][slot][slot][slot][slot][slot][slot][slot]

---

4. Slot States & Rules

4.1 Slot mapping

Let:
- `owned` = total units of this building
- `slotIndex` = 0–9 (10 slots)
- `slotRange` = 100 units per slot

For each slot:

- `slotMin = slotIndex * 100`
- `slotMax = slotMin + 100`

State rules:
- If `owned <= slotMin` → **Empty**
- If `owned >= slotMax` → **Full**
- Else → **Partial** (owned is between slotMin and slotMax)

4.2 Partial fill percentage

For partial slots:

- `progress = (owned - slotMin) / 100`
- `progress` is clamped between 0 and 1
- Used to drive a visual fill (e.g., gradient or mask)

---

5. Icon System (Per Building)

Each building uses a distinct icon inside each slot:

- Poker Table:
  - Icon: mini poker table silhouette
  - Theme: green felt, gold rim

- Pro Dealers:
  - Icon: bowtie / dealer badge

- Card Shufflers:
  - Icon: card shuffle machine

- TDs:
  - Icon: clipboard / whistle

- Higher buildings (from V2.1+):
  - Each gets a unique, simple silhouette matching its theme
  - Icons must be readable at small size

Icons are:
- Single‑color or simple 2‑tone
- Designed to work in empty, partial, and full states

---

6. Visual States (Empty / Partial / Full)

6.1 Empty

- Icon: low opacity (e.g., 25–35%)
- Background: subtle, dark capsule or rounded square
- No glow, no animation

6.2 Partial

- Icon: normal opacity
- Background: filled proportionally from left to right based on `progress`
- Visual: gradient or mask (e.g., gold → dark)
- Optional subtle shimmer when progress increases

6.3 Full

- Icon: full opacity
- Background: fully filled (gold or bright color)
- Effects on transition to full:
  - 150ms scale pop (e.g., 1.0 → 1.1 → 1.0)
  - 200ms glow pulse
- No continuous animation after settling (idle‑friendly)

---

7. Behaviour on Purchase

When the player buys more units of a building:

1. `owned` updates as normal (no change to logic).
2. Meter recalculates slot states.
3. For any slot that:
   - Moves from Empty → Partial:
     - Quick fade‑in of icon/partial fill (100–150ms).
   - Moves from Partial → Full:
     - Play the “full” animation (scale pop + glow pulse).
4. No animation for slots that remain in the same state.

This keeps feedback punchy but not noisy.

---

8. Edge Cases & Caps

- For `owned >= 1000`:
  - All 10 slots remain in Full state.
  - “Owned: X” continues to show the true number.
  - No additional visual states are added.

- For `owned = 0`:
  - All slots Empty.
  - No animation.

- For bulk purchases (e.g., Buy 100, Buy Max):
  - Animations may trigger on multiple slots in sequence.
  - It is acceptable for multiple slots to pop in the same frame.

---

9. Performance & Implementation Notes

- The meter is purely visual; it must not affect any game logic.
- No timers, cps, costs, or formulas are touched.
- Implementation should:
  - Use a simple loop over 10 slots.
  - Derive state from `owned` only.
  - Avoid per‑frame JS; only update on `owned` change.

---

10. Non‑Negotiable Rules

You must not:
- Change building costs or cps.
- Modify any economy formulas.
- Alter buy logic or unlock rules.
- Add new progression systems tied to the meter.

You must:
- Implement the 10‑slot meter exactly as described.
- Keep all existing systems functionally identical.
- Ensure the meter is readable on mobile.
- Ensure the meter does not overlap or break existing layout.

---

11. Success Criteria

- A player with 1–999 units of a building sees a clear, intuitive progression bar made of 10 icon slots.
- A player with 1000+ units sees a fully lit meter and a growing “Owned” number.
- No change in cps, costs, or progression pacing compared to pre‑V401.
- The UI feels cleaner, more premium, and more readable at a glance.
