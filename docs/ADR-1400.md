**V1400 – Unified Game Architecture (No Demo Route)**  
**Status:** Draft for Review  
**Scope:** Core Routing + Landing Flow + Install Funnel  
**Drift:** Not permitted after approval  
**Version:** 1400  
**Feature:** Unified Game Mode, Corrected Routing, Clean Install Funnel  
**Purpose:** Replace the broken V1301 demo system with a deterministic, single‑game architecture that supports new‑user onboarding, returning‑user fast‑path, and a clean “Add to Home Screen” conversion flow.

---

## **1. Overview**
V1400 removes the `/game` demo route introduced in V1301 and restores a **single‑source‑of‑truth game experience** located at:

```
/app
```

The landing page remains the public entry point, but now routes correctly into the real game.  
The system supports:

- A clean **new‑user onboarding** flow  
- A fast **returning‑user skip**  
- A simple **install funnel**  
- A deterministic **save system**  
- No duplicate game UIs  
- No demo mode  
- No preview build  
- No second game route  

This version is required before deployment.

---

## **2. Routing Rules**
### **/landing (public marketing page)**  
**Purpose:** Introduce the game, encourage installation, and route new users into the real game.

**Behaviour:**
- New users land here by default  
- Returning users skip this page entirely  
- Buttons:  
  - **Play Now** → `/app`  
  - **Add to Home Screen** → triggers PWA install instructions  

**Forbidden:**  
- No routing to `/game`  
- No demo mode  
- No preview UI  

---

### **/app (full game)**  
**Purpose:** The only game mode. All gameplay, progression, saving, and UI originate here.

**Behaviour:**
- Loads save data if present  
- Starts fresh if no save exists  
- Shows “Welcome Back” modal for returning users  
- Supports full progression, shop, minigames, achievements, etc.  
- Supports PWA install detection  

**Exit Warning (new users only):**  
If the user has no save and tries to leave:  
> “Your progress will not be saved unless you add Poker Idle Empire to your home screen.”

**Forbidden:**  
- No demoMode flag  
- No preview restrictions  
- No duplicate UI  
- No unlocked minigames for new users  

---

### **Removed Route: /game**  
The entire `/game` folder is removed.

**Reason:**  
It introduced a second game, a broken demo, and a conflicting architecture.  
It caused new users to load the wrong experience and broke the landing flow.

**Forbidden:**  
- No `/game` route  
- No demoMode = true  
- No demo‑specific UI  
- No preview build  
- No conversion banners  
- No demo exit modal  

---

## **3. Landing Page Behaviour**
### **New User Flow**
1. User visits `/`  
2. User sees landing page  
3. User taps **Play Now**  
4. User is routed to `/app`  
5. Game starts fresh  
6. On exit, user receives save warning unless installed  

### **Returning User Flow**
1. User visits `/`  
2. System detects save data  
3. User is automatically routed to `/app`  
4. “Welcome Back” modal appears  

### **Install Funnel**
- “Add to Home Screen” button on landing  
- Optional install prompt inside `/app` for new users  
- No banners, no demo‑specific UI  

---

## **4. Save System Rules**
### **Saving Enabled**
- LocalStorage is always active  
- Saves occur on interval and on exit  
- No restrictions  

### **New User Warning**
If no save exists and user attempts to leave:  
> “Your progress will not be saved unless you add Poker Idle Empire to your home screen.”

### **Forbidden**
- No save‑locked mode  
- No disabled saving  
- No demo restrictions  

---

## **5. UI Rules**
### **Landing Page**
- Clean marketing layout  
- Screenshots  
- Play Now button  
- Add to Home Screen button  

### **Game UI (/app)**
- Full game interface  
- Shop enabled  
- Minigames locked behind progression  
- Achievements enabled  
- Daily rewards enabled  

### **Forbidden**
- No demo badges  
- No demo banners  
- No demo‑specific tooltips  
- No “Install to Save” persistent bar  

---

## **6. Architecture Rules**
### **Single Game Source**
All gameplay logic, stores, systems, and UI live under:

```
src/routes/app/
```

### **Landing Page**
Lives under:

```
src/routes/landing/
```

### **Root Redirect**
`src/routes/+page.ts` handles:

- Detect save → redirect to `/app`  
- No save → show landing  

### **Forbidden**
- No duplicate game folders  
- No duplicate layouts  
- No demoMode branching  
- No second game entry point  

---

## **7. Drift Prevention**
The following are strictly forbidden in V1400:

- No `/game` route  
- No demoMode flag  
- No demo UI components  
- No preview builds  
- No unlocked minigames for new users  
- No disabled saving  
- No conversion banners  
- No demo exit modal  
- No duplicate game logic  
- No duplicate layouts  
- No routing to `/game` from any component  

Any deviation requires V1401+.

---

## **8. Deliverables**
- Remove `/game` folder  
- Update landing “Play Now” → `/app`  
- Update root redirect logic  
- Remove demoMode from all stores  
- Remove demo components  
- Remove demo UI  
- Remove demo exit modal  
- Remove demo banners  
- Ensure `/app` is the only game  
- Ensure landing → app flow is correct  
- Ensure returning users skip landing  