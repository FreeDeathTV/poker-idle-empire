# **ADR‑1501: Heads‑Up Betting Engine & Blind Ladder**

## **Context**
The new Heads‑Up Hold’em Ladder Mode (defined in ADR‑1500) requires a lightweight but fully deterministic betting engine that supports two‑player No‑Limit Hold’em with shrinking blind levels. The existing game only includes a simplified single‑player Hold’em bonus with instant resolution and no betting rounds, no turn order, and no stack management. A proper heads‑up engine is needed to support:

- Preflop, flop, turn, river betting rounds  
- Fold, call, raise, all‑in actions  
- Stack tracking  
- Blind posting  
- Dealer/button rotation  
- Blind shrink progression  
- Deterministic AI decision points  

This engine must remain small, modal‑contained, and fully client‑side.

---

## **Decision**
Implement a **minimal deterministic heads‑up betting engine** that supports the full Hold’em flow but is restricted to two players, shallow stacks, and a fixed blind‑shrink ladder. The engine will be self‑contained, not shared with other game systems, and will run entirely inside the Heads‑Up Hold’em modal.

The engine will include:

- A strict state machine for betting rounds  
- A two‑player action loop  
- A simplified raise structure (No‑Limit only for ADR‑1501)  
- All‑in handling  
- Pot management  
- Blind posting and rotation  
- Blind shrink after each completed hand  
- Deterministic resolution and stack updates  

This engine will be the foundation for CPU AI integration (ADR‑1502) and progression/leaderboard logic (ADR‑1503).

---

## **State Machine**
The engine will follow a fixed sequence:

1. **Init Hand**  
   - Assign button  
   - Post blinds  
   - Deal hole cards  

2. **Preflop Betting**  
   - Action starts with player in big blind facing a raise or check  
   - Loop until both players are matched or one folds  

3. **Flop Betting**  
4. **Turn Betting**  
5. **River Betting**  
   - Same loop structure as preflop  
   - Action starts with small blind (button)  

6. **Showdown**  
   - Evaluate hands  
   - Award pot  
   - Handle split pots  

7. **Stack Update**  
   - Apply winnings  
   - Check for bust  

8. **Blind Shrink**  
   - Move to next blind level in ladder  
   - Reset stacks to new BB value  

9. **Next Hand**  
   - Rotate button  
   - Repeat until final blind level or bust  

This structure ensures predictable, testable behaviour.

---

## **Blind Shrink Ladder**
The blind ladder is fixed and shallow to ensure fast games:

- **10BB**  
- **7.4BB**  
- **5BB**  
- **2.5BB**  
- **1BB**  

After each completed hand:

- Both stacks reset to the new BB value  
- Blinds scale proportionally  
- Game ends at 1BB or if a player reaches 0 chips  

This keeps the engine simple and prevents long games.

---

## **Betting Rules**
The engine supports:

- Fold  
- Call  
- Check  
- Raise (No‑Limit)  
- All‑in  

Raise sizing:

- Minimum raise = previous raise size  
- Maximum raise = all‑in  
- If stack < call amount → forced all‑in  

All‑in resolution:

- No side pots (two‑player only)  
- Pot is awarded to winner or split  

This keeps the logic minimal and deterministic.

---

## **Turn Order**
Heads‑up turn order is:

- **Preflop:**  
  - Button posts small blind  
  - Opponent posts big blind  
  - Action starts with player facing the big blind  

- **Postflop:**  
  - Action starts with the small blind (button)  

Button rotates each hand.

---

## **Stack & Pot Management**
The engine tracks:

- Player stack  
- CPU stack  
- Current pot  
- Current bet to call  
- Amount invested per street  

All values reset each hand except blind level.

---

## **Integration Points**
The engine exposes:

- `startHand()`  
- `applyAction(player, action, amount)`  
- `resolveShowdown()`  
- `advanceBlindLevel()`  
- `isGameOver()`  

These will be consumed by:

- CPU AI (ADR‑1502)  
- Progression modal & leaderboard (ADR‑1503)  
- Ace‑Token economy (ADR‑1504 if needed)  

---

## **Rationale**
This engine:

- Fits the modal‑contained design  
- Requires no networking or concurrency  
- Reuses existing card logic  
- Keeps complexity low  
- Supports deterministic AI behaviour  
- Enables a full Hold’em experience without scope creep  

It is intentionally limited to heads‑up No‑Limit Hold’em to avoid multi‑player complexity.

---

## **Consequences**
### Positive
- Fully deterministic and testable  
- Small code footprint  
- Reusable for Limit mode later  
- Supports all CPU personalities  
- Fast gameplay loop  

### Negative
- Not reusable for 3+ players  
- Requires careful tuning to avoid infinite betting loops  
- Requires UI adjustments for betting controls  

---

## **Status**
**Accepted.**  
Implementation proceeds to ADR‑1502 (CPU AI Profiles & Behaviour System).

