V301.md Reset Flow ‚Äî Hardened Edition (Final Spec)
Status: ‚úÖ IMPLEMENTED
Purpose: Replace the plain prestige reset with a cinematic, narrative, casino‚Äëthemed "Escape & Relocate" ritual that is ALWAYS positive, ALWAYS exciting, and NEVER punishing.

---

## ‚úÖ IMPLEMENTATION COMPLETE

**Date Completed:** 2026-02-21
**Implementation Status:** Full V301 Reset Flow deployed
**All Requirements:** Met ‚úì

### Files Created:
- `/src/components/ResetFlow.svelte` - 3-stage reset modal (method selection ‚Üí wheel spin ‚Üí results)
- `/src/components/Confetti.svelte` - Lightweight CSS+JS confetti animation (20-30 particles, 2s duration)

### Files Modified:
- `/src/lib/stores.ts` - 9 new stores for reset flow state management
- `/src/lib/gameLogic.ts` - Wheel definitions, bonus calculations, reset flow functions (60+ lines)
- `/src/routes/+page.svelte` - Integrated ResetFlow component, added signingBonusTotal display

### Verification Results:
- ‚úÖ All wheel probabilities sum to 100%
- ‚úÖ BaseBonus formula verified (10% ‚Üí 50% cap)
- ‚úÖ Minimum Guarantee & Late-Game Soft Floor implemented
- ‚úÖ All 18 outcomes with exact multipliers/probabilities
- ‚úÖ Save/load persistence verified
- ‚úÖ No regressions in existing systems
- ‚úÖ Mobile-safe animations with large hitboxes
- ‚úÖ Toast message format matches spec exactly

---

1. Reset Trigger (Unchanged)
Reset becomes available at:

‚â• 1e12 chips

Button label:

‚ÄúEscape & Relocate‚Äù

This opens the new 3‚Äëstage reset flow.

2. Stage 1 ‚Äî Choose Escape Method (Player Choice Layer)
Three options, each with a different average multiplier and risk profile.

Method	Theme	Avg Multiplier	Risk Profile	Icon
Relocation Officer	Safe, official escape	1.3√ó	Low risk	Briefcase
New Identity Kit	Risky makeover	1.5√ó	Medium risk	Mask
Just Run	Desperate sprint	1.1√ó	Very low risk	Running shoes
Design Rules
All outcomes are positive (0.8√ó to 2√ó).

No penalties that reduce progress.

No ‚Äúlose 50%‚Äù or ‚Äúlose 80%‚Äù outcomes.

The worst outcome is simply a lower multiplier.

This eliminates rage‚Äëquits and aligns with idle‚Äëgame prestige psychology.

3. Stage 2 ‚Äî Wheel Spin (Outcome Layer)
Each method has 6 outcomes (fixed, easy to tune).

Relocation Officer Wheel (Safe, Reliable)
Outcome	Message	Multiplier	Probability
VIP Jet Escape	‚ÄúPrivate jet secured!‚Äù	2.0√ó	10%
Private Yacht	‚ÄúSmooth sailing to safety.‚Äù	1.5√ó	30%
Luxury Limo	‚ÄúDriver knew a shortcut.‚Äù	1.3√ó	30%
Economy Flight	‚ÄúLong queues, but you made it.‚Äù	1.0√ó	20%
Bus Ride	‚ÄúSlow but steady.‚Äù	0.9√ó	8%
Hitchhike	‚ÄúSketchy, but it worked.‚Äù	0.8√ó	2%
Average: ~1.3√ó

New Identity Kit Wheel (High‚ÄëRisk/High‚ÄëReward)
Outcome	Multiplier	Notes
Elite Surgeon	2.0√ó	Jackpot
Perfect Disguise	1.7√ó	Strong
Celebrity Lookalike	1.5√ó	Strong
New Passport	1.2√ó	Neutral
Cheap Mask	1.0√ó	Meh
Botched Job	0.8√ó	Floor
Average: ~1.5√ó

Just Run Wheel (Chaotic but Safe)
Outcome	Multiplier	Notes
Lucky Break	1.5√ó	Rare
Found a Stash House	1.3√ó	Good
Taxi Escape	1.2√ó	Good
Back Alley Shortcut	1.0√ó	Neutral
Lost in the City	0.9√ó	Meh
Caught in Traffic	0.8√ó	Floor
Average: ~1.1√ó

4. Stage 3 ‚Äî Apply Reset (Progression Layer)
This is where the magic happens.

4.1 Base Signing Bonus (from V202)
ùêµ
ùëé
ùë†
ùëí
ùêµ
ùëú
ùëõ
ùë¢
ùë†
=
10
%
+
5
%
√ó
log
‚Å°
10
(
ùëÖ
ùëí
ùë†
ùëí
ùë°
ùë†
+
1
)
Capped at 50%.

‚≠ê 4.1.1 Minimum Gain Guarantee (New Safety Upgrade)
To prevent early‚Äëgame ‚Äúweak resets‚Äù:

ùêπ
ùëñ
ùëõ
ùëé
ùëô
ùêµ
ùëú
ùëõ
ùë¢
ùë†
=
max
‚Å°
(
ùêµ
ùëé
ùë†
ùëí
ùêµ
ùëú
ùëõ
ùë¢
ùë†
√ó
ùëä
‚Ñé
ùëí
ùëí
ùëô
ùëÄ
ùë¢
ùëô
ùë°
ùëñ
ùëù
ùëô
ùëñ
ùëí
ùëü
,
¬†
10
%
)
This ensures every reset feels meaningful.

‚≠ê 4.1.2 Late‚ÄëGame Soft Floor (New Safety Upgrade)
To prevent late‚Äëgame frustration streaks:

If Resets > 20:

ùëä
‚Ñé
ùëí
ùëí
ùëô
ùëÄ
ùë¢
ùëô
ùë°
ùëñ
ùëù
ùëô
ùëñ
ùëí
ùëü
=
max
‚Å°
(
ùëä
‚Ñé
ùëí
ùëí
ùëô
ùëÄ
ùë¢
ùëô
ùë°
ùëñ
ùëù
ùëô
ùëñ
ùëí
ùëü
,
¬†
1.0
)
This keeps the early game exciting and the late game smooth.

4.2 Wheel Multiplier
Applied to this reset only:

ùêπ
ùëñ
ùëõ
ùëé
ùëô
ùêµ
ùëú
ùëõ
ùë¢
ùë†
=
ùêµ
ùëé
ùë†
ùëí
ùêµ
ùëú
ùëõ
ùë¢
ùë†
√ó
ùëä
‚Ñé
ùëí
ùëí
ùëô
ùëÄ
ùë¢
ùëô
ùë°
ùëñ
ùëù
ùëô
ùëñ
ùëí
ùëü
(After applying the minimum guarantee and soft floor.)

4.3 Prestige Point
+1 prestige point

Prestige multiplier = 
1.1
ùëù
ùëú
ùëñ
ùëõ
ùë°
ùë†

4.4 Reset State
After applying the bonus:

Chips ‚Üí 0

Buildings ‚Üí 0

Boosts ‚Üí 0

Prestige multiplier ‚Üí kept

Signing bonus ‚Üí added

Escape history ‚Üí updated

4.5 Toast
Example:

‚ÄúVIP Jet Escape! √ó2.0 bonus applied. Permanent bonus +22%.‚Äù

5. UX & Mobile Hardening
5.1 Auto‚Äëspin
Tap method ‚Üí wheel auto‚Äëspins

2s animation

No manual dragging

5.2 Re‚Äëspin Option (Optional)
Cost: 10% of this reset‚Äôs signing bonus

Only available once per reset

Prevents ‚Äúbad streak frustration‚Äù

5.3 Big hitboxes
Large buttons

No accidental taps

5.4 Confetti for >1.5√ó
Small, tasteful

Mobile‚Äësafe

6. Save/Load
Store only:

lastEscapeMethod

lastOutcome

wheelHistory (max 5 entries)

prestigePoints

signingBonusTotal

No bloat.

7. QA Checklist
20 resets with each method

No negative outcomes

No ‚Äúfeels bad‚Äù moments

Wheel probabilities correct

Mobile animation smooth

Reset always progresses player